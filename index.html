<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小组图片拼接</title>
    <link rel="stylesheet" href="/static/picocss/css/pico.css">
    <link rel="stylesheet" href="/static/main.css">
    <script src="/static/main.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script async defer data-website-id="04463641-ed4b-4d0f-af66-c66dec1b5d94" src="https://ana.evax.top/umami.js"
            id="umami-js"></script>
</head>
<body>

<main class="container">
    <h1>小组图片拼接</h1>
    <!-- 选择7人或8人 -->
    <form name="numForm" id="numForm">
        <fieldset class="horizontal_item">
            <legend>选择人数</legend>
            <label class="horizontal_item umami--click--num-change-to-7"><input type="radio" name="num" value="7"
                                                                                checked>7人</label>
            <label class="horizontal_item umami--click--num-change-to-8"><input type="radio" name="num"
                                                                                value="8">8人</label>
        </fieldset>
        <fieldset class="horizontal_item">
            <legend>添加图片</legend>
            <label class="horizontal_item">额外文字(可选)<input type="text" name="text"
                                                                class="umami--click--change-text"
                                                                placeholder="张三 06:30"></label>
            <label class="horizontal_item"><input type="file" name="file" accept="image/*"
                                                  class="umami--change--add-one-picture"></label>
        </fieldset>
    </form>
    <button id="btn" class="umami--click--generate-picture">生成</button>

    <article>
        <canvas id="canvas"></canvas>
    </article>

    <script>
        window.onload = function () {
            const num = document.forms['numForm'].num.value;
            initCanvas(parseInt(num));
            umami.trackEvent("Init Canvas", {num: num});
        }
        // 监听 7人或8人 的选择
        document.forms['numForm'].num.forEach((item) => {
            item.addEventListener('change', (e) => {
                initCanvas(parseInt(e.target.value));
                umami.trackEvent("Init Canvas", {num: e.target.value});
            });
        });
        document.forms['numForm'].file.addEventListener('change', (e) => {
            const text = document.forms['numForm'].text.value;
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function () {
                const img = new Image();
                // noinspection JSValidateTypes
                img.src = reader.result;
                img.onload = function () {
                    drawPic(img, text);
                    e.target.value = '';
                    document.forms['numForm'].text.value = '';
                    umami.trackEvent("Add One Picture", {text: text, num: CanvasData.num, index: CanvasData.drawn});
                }
            }
        });
        document.getElementById("btn").addEventListener('click', () => {
            download()
            umami.trackEvent("Download Picture", {num: CanvasData.num, drawn: CanvasData.drawn});
        })
    </script>

    <footer>
        <p>Open Source on <a href="https://github.com/gggxbbb/simpleImageStitching">Github</a></p>
        <p>Deployed on Cloudflare Pages</p>
    </footer>
</main>

</body>
</html>
